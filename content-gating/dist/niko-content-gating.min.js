/*! For license information please see niko-content-gating.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NikoContentGating=e():t.NikoContentGating=e()}(this,()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function o(t,e,n){return(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function u(n,r,o,i){var u=r&&r.prototype instanceof s?r:s,l=Object.create(u.prototype);return a(l,"_invoke",function(n,r,o){var i,a,u,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,a=0,u=t,y.n=n,c}};function h(n,r){for(a=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],h=y.p,p=i[2];n>3?(o=p===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(a=0,y.v=r,y.n=i[1]):h<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,y.n=p,a=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),a=l,u=p;(e=a<2?t:u)||!f;){i||(a?a<3?(a>1&&(y.n=-1),h(a,u)):y.n=u:y.v=u);try{if(s=2,i){if(a||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,a<2&&(a=0)}else 1===a&&(e=i.return)&&e.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((e=(f=y.n<0)?u:n.call(r,y))!==c)break}catch(e){i=t,a=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var y=[][r]?e(e([][r]())):(a(e={},r,function(){return this}),e),h=f.prototype=s.prototype=Object.create(y);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,o,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=f,a(h,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,o,"GeneratorFunction"),a(h),a(h,o,"Generator"),a(h,r,function(){return this}),a(h,"toString",function(){return"[object Generator]"}),(i=function(){return{w:u,m:p}})()}function a(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,n,r){function i(e,n){a(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},a(t,e,n,r)}function u(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){u(i,r,o,a,c,"next",t)}function c(t){u(i,r,o,a,c,"throw",t)}a(void 0)})}}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function l(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}t.r(e),t.d(e,{default:()=>x});const f=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.coreAuthSystem=null,this.authState={isAuthenticated:!1,userType:null,lastVerified:null},this.verificationInterval=null,this.VERIFICATION_INTERVAL=3e5,this.SESSION_KEY="niko_content_gating_state"},e=[{key:"init",value:(a=c(i().m(function t(e){return i().w(function(t){for(;;)switch(t.n){case 0:return this.coreAuthSystem=e,this.loadAuthState(),t.n=1,this.verifyAuthState();case 1:return t.v&&this.startPeriodicVerification(),t.a(2,this.authState)}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"loadAuthState",value:function(){try{var t=sessionStorage.getItem(this.SESSION_KEY);if(t){var e=JSON.parse(t);if(e.lastVerified&&Date.now()-e.lastVerified<6e5)return this.authState=e,!0}}catch(t){console.warn("Failed to load cached content gating state:",t)}return this.clearAuthState(),!1}},{key:"verifyAuthState",value:(n=c(i().m(function t(){var e,n,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=this.coreAuthSystem.getCurrentUser(),n=this.coreAuthSystem.getUserRole(),e){t.n=1;break}return this.clearAuthState(),t.a(2,!1);case 1:return this.authState={isAuthenticated:!0,userType:n||"Customer",userId:e.id,email:e.email,lastVerified:Date.now()},this.cacheAuthState(),t.a(2,!0);case 2:return t.p=2,r=t.v,console.error("Content gating auth verification failed:",r),this.clearAuthState(),t.a(2,!1)}},t,this,[[0,2]])})),function(){return n.apply(this,arguments)})},{key:"cacheAuthState",value:function(){try{var t={isAuthenticated:this.authState.isAuthenticated,userType:this.authState.userType,lastVerified:this.authState.lastVerified};sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(t))}catch(t){console.warn("Failed to cache content gating state:",t)}}},{key:"clearAuthState",value:function(){this.authState={isAuthenticated:!1,userType:null,lastVerified:null};try{sessionStorage.removeItem(this.SESSION_KEY)}catch(t){console.warn("Failed to clear content gating session storage:",t)}this.stopPeriodicVerification()}},{key:"startPeriodicVerification",value:function(){var t=this;this.stopPeriodicVerification(),this.verificationInterval=setInterval(c(i().m(function e(){var n;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.verifyAuthState();case 1:e.v||null===(n=t.onAuthStateChange)||void 0===n||n.call(t,!1,null);case 2:return e.a(2)}},e)})),this.VERIFICATION_INTERVAL)}},{key:"stopPeriodicVerification",value:function(){this.verificationInterval&&(clearInterval(this.verificationInterval),this.verificationInterval=null)}},{key:"getAuthState",value:function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this.authState)}},{key:"isAuthenticated",value:function(){return this.authState.isAuthenticated}},{key:"getUserType",value:function(){return this.authState.userType}},{key:"setAuthStateChangeCallback",value:function(t){this.onAuthStateChange=t}},{key:"redirectToLogin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.coreAuthSystem&&"function"==typeof this.coreAuthSystem.redirectToLogin)this.coreAuthSystem.redirectToLogin(t);else{var e="/dev/app/auth/log-in",n=t||window.location.pathname+window.location.search;n.includes("/auth/")?window.location.href=e:window.location.href="".concat(e,"?return=").concat(encodeURIComponent(n))}}}],e&&s(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function h(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof u?r:u,s=Object.create(c.prototype);return p(s,"_invoke",function(n,r,o){var i,u,c,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,u=0,c=t,y.n=n,a}};function h(n,r){for(u=n,c=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],h=y.p,p=i[2];n>3?(o=p===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(u=0,y.v=r,y.n=i[1]):h<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,y.n=p,u=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),u=l,c=p;(e=u<2?t:c)||!f;){i||(u?u<3?(u>1&&(y.n=-1),h(u,c)):y.n=c:y.v=c);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(f=y.n<0)?c:n.call(r,y))!==a)break}catch(e){i=t,u=1,c=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function u(){}function c(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(p(e={},r,function(){return this}),e),f=s.prototype=u.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,p(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=s,p(f,"constructor",s),p(s,"constructor",c),c.displayName="GeneratorFunction",p(s,o,"GeneratorFunction"),p(f),p(f,o,"Generator"),p(f,r,function(){return this}),p(f,"toString",function(){return"[object Generator]"}),(h=function(){return{w:i,m:y}})()}function p(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}p=function(t,e,n,r){function i(e,n){p(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},p(t,e,n,r)}function d(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function g(t){var e=function(t){if("object"!=y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}const m=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isInitialized=!1,this.filterInstances=[]},e=[{key:"init",value:(n=h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.waitForFinsweet();case 1:this.setupFilters(),this.isInitialized=!0,console.log("Content Gating Finsweet integration initialized");case 2:return t.a(2)}},t,this)}),r=function(){var t=this,e=arguments;return new Promise(function(r,o){var i=n.apply(t,e);function a(t){d(i,r,o,a,u,"next",t)}function u(t){d(i,r,o,a,u,"throw",t)}a(void 0)})},function(){return r.apply(this,arguments)})},{key:"waitForFinsweet",value:function(){return new Promise(function(t){if(window.fsAttributes)t();else{var e=setInterval(function(){window.fsAttributes&&(clearInterval(e),t())},100);setTimeout(function(){clearInterval(e),console.warn("Finsweet Attributes not loaded for content gating"),t()},1e4)}})}},{key:"setupFilters",value:function(){var t=this;window.fsAttributes?window.fsAttributes.push(["listfilter",function(e){t.filterInstances=e,console.log("Content gating list filters initialized:",e.length)}]):console.warn("Finsweet Attributes not available for content gating")}},{key:"applyContentGating",value:function(t,e){var n=this;this.isInitialized&&0!==this.filterInstances.length?this.filterInstances.forEach(function(r){try{t?n.showAuthenticatedContent(r,e):n.showGuestContent(r)}catch(r){console.error("Content gating filter application error:",r),n.applyCSSGating(t,e)}}):this.applyCSSGating(t,e)}},{key:"showAuthenticatedContent",value:function(t,e){if(document.querySelectorAll('[niko-data*="guest-only"]').forEach(function(t){return t.style.display="none"}),document.querySelectorAll('[niko-data*="authenticated-only"]').forEach(function(t){return t.style.display=""}),e){document.querySelectorAll('[niko-data*="'.concat(e.toLowerCase(),'"]')).forEach(function(t){return t.style.display=""});var n="customer"===e.toLowerCase()?"retailer":"customer";document.querySelectorAll('[niko-data*="'.concat(n,'"]')).forEach(function(t){return t.style.display="none"})}console.log("Content gated for authenticated ".concat(e))}},{key:"showGuestContent",value:function(t){document.querySelectorAll('[niko-data*="guest-only"]').forEach(function(t){return t.style.display=""}),document.querySelectorAll('[niko-data*="authenticated-only"]').forEach(function(t){return t.style.display="none"}),document.querySelectorAll('[niko-data*="customer"]').forEach(function(t){return t.style.display="none"}),document.querySelectorAll('[niko-data*="retailer"]').forEach(function(t){return t.style.display="none"}),console.log("Content gated for guests")}},{key:"applyCSSGating",value:function(t,e){var n=document.getElementById("niko-content-gating-css")||document.createElement("style");if(n.id="niko-content-gating-css",t){var r="customer"===(null==e?void 0:e.toLowerCase())?"retailer":"customer";n.textContent='\n                [niko-data*="guest-only"] { display: none !important; }\n                [niko-data*="authenticated-only"] { display: initial !important; }\n                [niko-data*="'.concat(null==e?void 0:e.toLowerCase(),'"] { display: initial !important; }\n                [niko-data*="').concat(r,'"] { display: none !important; }\n            ')}else n.textContent='\n                [niko-data*="guest-only"] { display: initial !important; }\n                [niko-data*="authenticated-only"] { display: none !important; }\n                [niko-data*="customer"] { display: none !important; }\n                [niko-data*="retailer"] { display: none !important; }\n            ';document.head.contains(n)||document.head.appendChild(n),console.log("Applied CSS content gating: ".concat(t?"".concat(e," authenticated"):"guest"))}},{key:"refreshGating",value:function(t,e){this.applyContentGating(t,e)}}],e&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function w(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof u?r:u,s=Object.create(c.prototype);return S(s,"_invoke",function(n,r,o){var i,u,c,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,u=0,c=t,y.n=n,a}};function h(n,r){for(u=n,c=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],h=y.p,p=i[2];n>3?(o=p===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(u=0,y.v=r,y.n=i[1]):h<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,y.n=p,u=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),u=l,c=p;(e=u<2?t:c)||!f;){i||(u?u<3?(u>1&&(y.n=-1),h(u,c)):y.n=c:y.v=c);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(f=y.n<0)?c:n.call(r,y))!==a)break}catch(e){i=t,u=1,c=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function u(){}function c(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(S(e={},r,function(){return this}),e),f=s.prototype=u.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,S(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=s,S(f,"constructor",s),S(s,"constructor",c),c.displayName="GeneratorFunction",S(s,o,"GeneratorFunction"),S(f),S(f,o,"Generator"),S(f,r,function(){return this}),S(f,"toString",function(){return"[object Generator]"}),(w=function(){return{w:i,m:y}})()}function S(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}S=function(t,e,n,r){function i(e,n){S(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},S(t,e,n,r)}function k(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function A(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){k(i,r,o,a,u,"next",t)}function u(t){k(i,r,o,a,u,"throw",t)}a(void 0)})}}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function C(t){var e=function(t){if("object"!=b(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==b(e)?e:e+""}const P=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.authManager=new f,this.finsweetManager=new m,this.isInitialized=!1,this.coreAuthSystem=null},e=[{key:"init",value:(o=A(w().m(function t(e){var n,r,o=this;return w().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log("Initializing content gating controller..."),this.coreAuthSystem=e,t.n=1,this.authManager.init(e);case 1:return n=t.v,t.n=2,this.finsweetManager.init();case 2:return this.authManager.setAuthStateChangeCallback(function(t,e){o.handleAuthStateChange(t,e)}),this.applyContentGating(n.isAuthenticated,n.userType),this.isInitialized=!0,console.log("Content gating controller initialized"),t.a(2,n);case 3:throw t.p=3,r=t.v,console.error("Content gating controller initialization failed:",r),this.finsweetManager.applyCSSGating(!1,null),r;case 4:return t.a(2)}},t,this,[[0,3]])})),function(t){return o.apply(this,arguments)})},{key:"handleAuthStateChange",value:function(t,e){console.log("Content gating detected auth state change:",{isAuthenticated:t,userType:e}),t?this.applyContentGating(t,e):this.applyContentGating(!1,null)}},{key:"applyContentGating",value:function(t,e){try{if(this.finsweetManager.applyContentGating(t,e),document.body.classList.toggle("niko-authenticated",t),document.body.classList.toggle("niko-guest",!t),t&&e){document.body.classList.add("niko-".concat(e.toLowerCase()));var n="customer"===e.toLowerCase()?"retailer":"customer";document.body.classList.remove("niko-".concat(n))}else document.body.classList.remove("niko-customer","niko-retailer");console.log("Content gating applied: ".concat(t?"".concat(e," authenticated"):"guest"))}catch(t){console.error("Content gating application failed:",t)}}},{key:"refreshAuthState",value:(r=A(w().m(function t(){var e,n;return w().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}return t.a(2,!1);case 1:return t.n=2,this.authManager.verifyAuthState();case 2:return e=t.v,n=this.authManager.getAuthState(),this.applyContentGating(n.isAuthenticated,n.userType),t.a(2,e)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getAuthState",value:function(){return this.authManager.getAuthState()}},{key:"redirectToLogin",value:function(t){this.authManager.redirectToLogin(t)}},{key:"gateElement",value:function(t){var e,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this.authManager.getAuthState(),i=!0;return n&&!o.isAuthenticated&&(i=!1),r&&(null===(e=o.userType)||void 0===e?void 0:e.toLowerCase())!==r.toLowerCase()&&(i=!1),t&&(t.style.display=i?"":"none",t.setAttribute("data-gated",i?"false":"true")),i}},{key:"addLoginPrompt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Please log in to access this feature";if(t&&!this.authManager.getAuthState().isAuthenticated){var n;if(null===(n=t.parentNode)||void 0===n?void 0:n.querySelector(".niko-login-prompt"))return;var r=document.createElement("div");r.className="niko-login-prompt",r.innerHTML="\n                <p>".concat(e,'</p>\n                <a href="/dev/app/auth/log-in?return=').concat(encodeURIComponent(window.location.pathname),'" class="niko-login-link">\n                    Login\n                </a>\n            '),r.style.cssText="\n                padding: 1rem;\n                background-color: #f8f9fa;\n                border: 1px solid #dee2e6;\n                border-radius: 0.375rem;\n                text-align: center;\n                margin: 0.5rem 0;\n            ";var o=r.querySelector(".niko-login-link");o&&(o.style.cssText="\n                    display: inline-block;\n                    padding: 0.5rem 1rem;\n                    background-color: #007bff;\n                    color: white;\n                    text-decoration: none;\n                    border-radius: 0.25rem;\n                    margin-top: 0.5rem;\n                "),t.style.display="none",t.parentNode.insertBefore(r,t.nextSibling)}}},{key:"refreshPageContent",value:(n=A(w().m(function t(){return w().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}return t.a(2);case 1:return t.n=2,this.refreshAuthState();case 2:if(!this.finsweetManager.isInitialized){t.n=3;break}return t.n=3,this.finsweetManager.init();case 3:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})}],e&&O(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o}();function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function T(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof u?r:u,s=Object.create(c.prototype);return G(s,"_invoke",function(n,r,o){var i,u,c,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,u=0,c=t,y.n=n,a}};function h(n,r){for(u=n,c=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],h=y.p,p=i[2];n>3?(o=p===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(u=0,y.v=r,y.n=i[1]):h<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,y.n=p,u=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),u=l,c=p;(e=u<2?t:c)||!f;){i||(u?u<3?(u>1&&(y.n=-1),h(u,c)):y.n=c:y.v=c);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(f=y.n<0)?c:n.call(r,y))!==a)break}catch(e){i=t,u=1,c=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function u(){}function c(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(G(e={},r,function(){return this}),e),f=s.prototype=u.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,G(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=s,G(f,"constructor",s),G(s,"constructor",c),c.displayName="GeneratorFunction",G(s,o,"GeneratorFunction"),G(f),G(f,o,"Generator"),G(f,r,function(){return this}),G(f,"toString",function(){return"[object Generator]"}),(T=function(){return{w:i,m:y}})()}function G(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}G=function(t,e,n,r){function i(e,n){G(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},G(t,e,n,r)}function I(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function E(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){I(i,r,o,a,u,"next",t)}function u(t){I(i,r,o,a,u,"throw",t)}a(void 0)})}}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,F(r.key),r)}}function F(t){var e=function(t){if("object"!=j(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}var L=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.controller=new P,this.isInitialized=!1,this.coreAuthSystem=null},e=[{key:"init",value:(r=E(T().m(function t(){var e,n;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,console.log("Initializing Niko Content Gating System..."),window.NikoPIM){t.n=1;break}throw console.warn("Core Niko PIM Authentication System not found. Content gating requires the core authentication system to be loaded first."),new Error("Missing core authentication system");case 1:return this.coreAuthSystem=window.NikoPIM,t.n=2,this.waitForCoreSystem();case 2:if(e=this.coreAuthSystem.supabase){t.n=3;break}throw new Error("Supabase client not available from core system");case 3:return t.n=4,this.controller.init(e);case 4:return this.isInitialized=!0,console.log("Niko Content Gating System initialized successfully"),this.exposePublicAPI(),t.a(2,!0);case 5:return t.p=5,n=t.v,console.error("Failed to initialize Content Gating System:",n),this.applyFallbackGating(),t.a(2,!1)}},t,this,[[0,5]])})),function(){return r.apply(this,arguments)})},{key:"waitForCoreSystem",value:(n=E(T().m(function t(){var e,n;return T().w(function(t){for(;;)switch(t.n){case 0:e=0,n=50;case 1:if(!(e<n)){t.n=4;break}if(!this.coreAuthSystem.isInitialized){t.n=2;break}return t.a(2);case 2:return t.n=3,new Promise(function(t){return setTimeout(t,100)});case 3:e++,t.n=1;break;case 4:throw new Error("Core authentication system not ready");case 5:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"applyFallbackGating",value:function(){var t=document.createElement("style");t.id="niko-content-gating-fallback",t.textContent='\n            [niko-data*="customer"] { display: none !important; }\n            [niko-data*="retailer"] { display: none !important; }\n        ',document.head.contains(t)||document.head.appendChild(t),console.log("Applied fallback content gating (guest-only mode)")}},{key:"exposePublicAPI",value:function(){var t,e,n=this;window.NikoContentGating={version:"1.0.0",isInitialized:function(){return n.isInitialized},getAuthState:function(){return n.controller.getAuthState()},refreshAuthState:(e=E(T().m(function t(){return T().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,n.controller.refreshAuthState();case 1:return t.a(2,t.v)}},t)})),function(){return e.apply(this,arguments)}),gateElement:function(t,e,r){return n.controller.gateElement(t,e,r)},addLoginPrompt:function(t,e){return n.controller.addLoginPrompt(t,e)},redirectToLogin:function(t){n.controller.redirectToLogin(t)},refreshGating:(t=E(T().m(function t(){return T().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,n.controller.refreshAuthState();case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),debug:{getController:function(){return n.controller},getCoreSystem:function(){return n.coreAuthSystem},applyTestGating:function(t,e){n.controller.applyContentGating(t,e)}}},window.NikoPIM&&(window.NikoPIM.ContentGating=window.NikoContentGating)}},{key:"refreshPageGating",value:function(){var t=this;this.isInitialized&&setTimeout(E(T().m(function e(){return T().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.controller.refreshAuthState();case 1:return e.a(2)}},e)})),100)}}],e&&_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();if("undefined"!=typeof window){var N=new L;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){N.init()}):N.init(),window.addEventListener("popstate",function(){N.refreshPageGating()}),window.NikoContentGatingSystem=N}const x=L;return e})());