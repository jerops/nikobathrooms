<!DOCTYPE html>
<html>
<head>
    <title>Login Test - NikoPIM</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Login Test</h1>
    <div id="status">Ready to test login...</div>
    
    <form id="loginForm">
        <h3>Login Test</h3>
        <input type="email" id="email" placeholder="Email" value="jerops@gmail.com">
        <input type="password" id="password" placeholder="Password" value="password123">
        <button type="submit">Test Login</button>
    </form>
    
    <div id="result" style="margin-top: 20px;"></div>
    
    <div id="userInfo" style="margin-top: 20px; padding: 10px; background: #f0f0f0;"></div>

    <script>
        console.log('üîç Starting login test...');
        
        // Use fresh API key
        const supabaseUrl = 'https://bzjoxjqfpmjhbfijthpp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6am94anFmcG1qaGJmaWp0aHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3NjIyMzksImV4cCI6MjA3MTMzODIzOX0.sL9omeLIgpgqYjTJM6SGQPSvUvm5z-Yr9rOzkOi2mJk';
        
        try {
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            document.getElementById('status').textContent = '‚úÖ Supabase client ready for login test';
            console.log('‚úÖ Supabase client created successfully');
            
            // Check current auth state
            supabase.auth.getSession().then(({ data: { session } }) => {
                if (session) {
                    console.log('üîÑ Already logged in as:', session.user.email);
                    document.getElementById('userInfo').innerHTML = `
                        <h4>Already logged in:</h4>
                        <p>Email: ${session.user.email}</p>
                        <p>User ID: ${session.user.id}</p>
                        <button onclick="logout()">Logout</button>
                    `;
                }
            });
            
            // Login form handler
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                console.log('üîÑ Attempting login for:', email);
                document.getElementById('result').textContent = 'Logging in...';
                document.getElementById('result').style.color = 'blue';
                
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) {
                        console.error('‚ùå Login error:', error);
                        document.getElementById('result').textContent = '‚ùå Login failed: ' + error.message;
                        document.getElementById('result').style.color = 'red';
                    } else {
                        console.log('‚úÖ Login successful:', data);
                        document.getElementById('result').textContent = '‚úÖ Login successful!';
                        document.getElementById('result').style.color = 'green';
                        
                        // Display user info
                        const user = data.user;
                        document.getElementById('userInfo').innerHTML = `
                            <h4>Login successful!</h4>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>User ID:</strong> ${user.id}</p>
                            <p><strong>Created:</strong> ${new Date(user.created_at).toLocaleDateString()}</p>
                            <p><strong>Last Sign In:</strong> ${new Date(user.last_sign_in_at).toLocaleString()}</p>
                            <p><strong>User Metadata:</strong> ${JSON.stringify(user.user_metadata, null, 2)}</p>
                            <button onclick="logout()" style="margin-top: 10px;">Logout</button>
                        `;
                        
                        console.log('User details:', {
                            id: user.id,
                            email: user.email,
                            metadata: user.user_metadata,
                            created_at: user.created_at
                        });
                    }
                } catch (err) {
                    console.error('‚ùå Login failed:', err);
                    document.getElementById('result').textContent = '‚ùå Login failed: ' + err.message;
                    document.getElementById('result').style.color = 'red';
                }
            });
            
            // Logout function
            window.logout = async () => {
                console.log('üîÑ Logging out...');
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    console.error('‚ùå Logout error:', error);
                } else {
                    console.log('‚úÖ Logout successful');
                    document.getElementById('result').textContent = '‚úÖ Logged out successfully';
                    document.getElementById('result').style.color = 'green';
                    document.getElementById('userInfo').innerHTML = '';
                }
            };
            
        } catch (error) {
            console.error('‚ùå Failed to create Supabase client:', error);
            document.getElementById('status').textContent = '‚ùå Failed to create Supabase client: ' + error.message;
        }
    </script>
</body>
</html>