!function(){const t="https://bzjoxjqfpmjhbfijthpp.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6am94anFmcG1qaGJmaWp0aHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3NjIyMzksImV4cCI6MjA3MTMzODIzOX0.ry3Xbso3Yr6HORiYZv3Bae1txMu1n7h4Ib3adKX1Qqs";class s{constructor(){this.supabase=null,this.currentUser=null,this.userRole=null,this.isInitialized=!1,this._ready=!1}async init(){console.log("Initializing Niko Auth Core...");try{this.supabase=await import("https://cdn.skypack.dev/@supabase/supabase-js").then(s=>s.createClient(t,e)),await this.checkAuthState(),this.setupEventListeners(),this.isInitialized=!0,this._ready=!0,console.log("✅ Niko Auth Core initialized successfully"),window.dispatchEvent(new CustomEvent("NikoAuthCore:ready")),console.log("✅ NikoAuthCore:ready event fired")}catch(t){console.error("Failed to initialize auth core:",t);throw t}}async checkAuthState(){try{const{data:{user:t}}=await this.supabase.auth.getUser();t&&(this.currentUser=t,this.userRole=t.user_metadata?.user_type||"Customer",console.log("User authenticated:",t.email,"Role:",this.userRole),window.location.pathname.includes("/auth/")&&this.redirectToDashboard())}catch(t){console.error("Auth state check failed:",t)}}setupEventListeners(){this.supabase.auth.onAuthStateChange(async(t,e)=>{console.log("Auth state changed:",t),await this.handleAuthStateChange(t,e)})}async handleAuthStateChange(t,e){switch(t){case"SIGNED_IN":this.currentUser=e.user,this.userRole=e.user.user_metadata?.user_type||"Customer",this.redirectToDashboard();break;case"SIGNED_OUT":this.currentUser=null,this.userRole=null}}async register(t,e,s,n){try{console.log("Registering user:",{email:t,name:s,userType:n});const{data:r,error:o}=await this.supabase.auth.signUp({email:t,password:e,options:{data:{name:s,user_type:n}}});return o?(console.error("Registration error:",o),{success:!1,error:o.message}):(console.log("User registered successfully:",r.user),{success:!0,user:r.user,message:"Registration successful! Please check your email for verification."})}catch(t){return console.error("Registration failed:",t),{success:!1,error:t.message}}}async login(t,e){try{console.log("Logging in user:",t);const{data:s,error:n}=await this.supabase.auth.signInWithPassword({email:t,password:e});return n?(console.error("Login error:",n),{success:!1,error:n.message}):(this.currentUser=s.user,this.userRole=s.user.user_metadata?.user_type||"Customer",console.log("User logged in successfully:",s.user.email),{success:!0,user:s.user,redirectUrl:this.getDashboardUrl()})}catch(t){return console.error("Login failed:",t),{success:!1,error:t.message}}}async logout(){try{const{error:t}=await this.supabase.auth.signOut();return t?(console.error("Logout error:",t),{success:!1,error:t.message}):(this.currentUser=null,this.userRole=null,console.log("User logged out successfully"),this.redirectToLogin(),{success:!0})}catch(t){return console.error("Logout failed:",t),{success:!1,error:t.message}}}getCurrentDomain(){return window.location.hostname}getBaseUrl(){const t=window.location.protocol,e=window.location.hostname,s=window.location.port;return e.includes("webflow.io")?`${t}//${e}`:`${t}//${e}${s?":"+s:""}`}getDashboardUrl(){const t=this.getBaseUrl(),e=(this.userRole?.toLowerCase()||"customer");return`${t}/dev/app/${e}/dashboard`}getLoginUrl(){const t=this.getBaseUrl();return`${t}/dev/app/auth/log-in`}redirectToDashboard(){const t=this.getDashboardUrl();console.log("Redirecting to dashboard:",t),window.location.href=t}redirectToLogin(t=null){const e=this.getLoginUrl(),s=t||window.location.pathname+window.location.search;s.includes("/auth/")?window.location.href=e:window.location.href=`${e}?return=${encodeURIComponent(s)}`}getCurrentUser(){return this.currentUser}getUserRole(){return this.userRole}isAuthenticated(){return!!this.currentUser}getIsInitialized(){return this.isInitialized}getSupabaseClient(){return this.supabase}}"undefined"!=typeof window&&function(){const t=new s;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await t.init()}):t.init(),window.NikoAuthCore={register:async(e,s,n,r)=>(console.log("NikoAuthCore.register called with:",{email:e,name:n,userType:r}),await t.register(e,s,n,r)),login:async(e,s)=>(console.log("NikoAuthCore.login called with:",e),await t.login(e,s)),logout:async()=>(console.log("NikoAuthCore.logout called"),await t.logout()),getCurrentUser:()=>t.getCurrentUser(),getUserRole:()=>t.getUserRole(),isAuthenticated:()=>t.isAuthenticated(),isInitialized:()=>t.getIsInitialized(),redirectToLogin:e=>t.redirectToLogin(e),redirectToDashboard:()=>t.redirectToDashboard(),getSupabaseClient:()=>t.getSupabaseClient(),_authCore:t,_ready:!0},console.log("✅ NikoAuthCore API exposed with methods:",Object.keys(window.NikoAuthCore))}()}();